# 国語入試問題分析システム 要件定義書

## 1. プロジェクト概要

### 1.1 目的
中学入試の国語問題（縦書きPDF）から出題傾向と出典情報を自動的に抽出・分析し、体系的に整理するシステムを構築する。

### 1.2 背景
- 入試問題の分析は手作業で行うと時間がかかる
- 複数年度・複数校の傾向比較が困難
- 出題パターンの把握が教育指導に重要

### 1.3 対象ユーザー
- オンライン家庭教師
- 教育関係者
- 受験指導者

## 2. 機能要件

### 2.1 入力
- **形式**: 縦書き日本語PDF（画像形式）
- **対象**: 中学入試国語問題および解答用紙
- **想定学校**: 麻布、開成、桜蔭等の難関校
- **ファイル構成**: 
  - 問題用紙（必須）
  - 解答用紙（オプション：配点・解答欄情報の参考用）

### 2.2 出力

#### 2.2.1 出題傾向分析
1. **大問構成**
   - 大問数
   - 各大問の配点（解答用紙から抽出）
   - 解答形式の分布（記号欄、記述欄のサイズ等）

2. **文章情報**
   - 文章の文字数（概算）
   - ジャンル分類
     - 説明文（論説文）
     - 物語文（小説）
     - 随筆（エッセイ）
     - 詩
     - 古文
     - その他

3. **設問分析**
   - 総設問数
   - 設問タイプ別集計
     - 語句・漢字問題
     - 記号選択問題（選択肢数：4択/5択等）
     - 抜き出し問題
     - 脱文挿入問題
     - 記述問題（指定文字数含む）
     - その他
   - 解答用紙情報（利用可能な場合）
     - 各設問の配点
     - 記述欄のサイズ（行数・マス数）
     - 解答形式の詳細

#### 2.2.2 出典情報
- 著者名
- 作品タイトル
- 出版社（可能な場合）
- 出版年（可能な場合）

### 2.3 出力形式
- **主形式**: Excel（.xlsx）
- **構成**:
  - Sheet1: サマリー（学校別・年度別一覧）
  - Sheet2: 詳細分析結果
  - Sheet3: 出典一覧
- **オプション**: CSV出力機能

## 3. 非機能要件

### 3.1 性能要件
- 1つのPDFファイル（10-15ページ）の処理時間：3分以内
- バッチ処理対応（複数ファイルの連続処理）

### 3.2 技術要件
- **言語**: Python 3.8以上
- **OCR**: Google Cloud Vision API
- **主要ライブラリ**:
  - google-cloud-vision
  - pandas
  - openpyxl
  - pdf2image
  - Pillow

### 3.3 環境要件
- **OS**: macOS / Windows / Linux
- **Google Cloud**: サービスアカウントキー設定済み
- **メモリ**: 4GB以上推奨

## 4. システム構成

### 4.1 モジュール構成
```
entrance_exam_analyzer/
├── main.py                 # メインプログラム
├── requirements.txt        # 依存パッケージ
├── config.py              # 設定ファイル
├── modules/
│   ├── pdf_processor.py   # PDF処理
│   ├── ocr_handler.py     # OCR処理
│   ├── text_analyzer.py   # テキスト分析
│   ├── pattern_extractor.py # パターン抽出
│   └── excel_writer.py    # Excel出力
├── data/
│   ├── input/            # 入力PDFフォルダ
│   └── output/           # 出力フォルダ
└── logs/                 # ログフォルダ
```

### 4.2 処理フロー
1. PDF読み込み（問題用紙・解答用紙）
2. 画像変換（必要に応じて）
3. Google Vision APIでOCR実行
4. テキストレイアウト解析
5. 問題用紙の処理
   - 大問・設問構造の識別
   - 設問タイプの分類
   - 出典情報の抽出
6. 解答用紙の処理（存在する場合）
   - 配点情報の抽出
   - 解答欄形式の分析
   - 記述欄のサイズ計測
7. 結果の統合・集計・分析
8. Excel形式で出力

## 5. 実装上の課題と対策

### 5.1 縦書きテキストの処理
- **課題**: 縦書きレイアウトの正確な認識
- **対策**: Google Vision APIのドキュメント解析機能を活用

### 5.2 設問パターンの識別
- **課題**: 多様な設問形式の正確な分類
- **対策**: 正規表現とキーワードベースのパターンマッチング

### 5.3 出典情報の抽出
- **課題**: 出典の記載位置・形式の多様性
- **対策**: 複数のパターンを定義し、優先順位付けして検索

### 5.4 解答用紙の解析
- **課題**: 解答欄の形式・レイアウトの多様性
- **対策**: 記号欄、記述欄のパターン認識と座標ベースの解析

## 6. 開発スケジュール

1. **Phase 1**: 基本機能実装（1-2日）
   - OCR処理の実装
   - 基本的なテキスト抽出

2. **Phase 2**: 分析機能実装（2-3日）
   - 設問パターン認識
   - 出典情報抽出

3. **Phase 3**: 出力・UI改善（1日）
   - Excel出力の整形
   - エラーハンドリング

## 7. 制約事項

- Google Cloud Vision APIの利用料金（月1000枚まで無料）
- OCR精度は100%ではないため、重要な情報は手動確認推奨
- 極端に画質が悪いPDFは処理不可の場合あり

## 8. 今後の拡張可能性

- Webインターフェースの追加
- 自動レポート生成機能
- 問題の難易度推定機能
- 類似問題の検索機能
- 出題傾向の経年変化分析