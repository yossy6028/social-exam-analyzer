#!/usr/bin/env python3
"""東京電機大学中学校2025年社会科問題の分析"""

import sys
import os
from pathlib import Path
sys.path.insert(0, str(Path(__file__).parent))

from modules.social_analyzer_fixed import FixedSocialAnalyzer as SocialAnalyzer
from modules.social_excel_formatter import SocialExcelFormatter
from modules.ocr_handler import OCRHandler
import logging

# ロギング設定
logging.basicConfig(
    level=logging.INFO,
    format='%(asctime)s - %(levelname)s - %(message)s'
)
logger = logging.getLogger(__name__)

def analyze_tdu_2025():
    """東京電機大学中学校2025年社会科問題を分析"""
    
    pdf_path = "/Users/yoshiikatsuhiko/Desktop/01_仕事 (Work)/オンライン家庭教師資料/過去問/東京電機大学中学校/2025年東京電機大学中学校問題_社会.pdf"
    
    # PDFの内容（既に読み取り済み）
    text = """
    1. 次の資料を読んで、各設問に答えなさい。
    
    資料【日本の薬の記述】
    ・『種々薬帳』は、（ ① ）の正倉院に奉納されている。生薬など60種が記載されている。
    ・『（ ② ）』には、かぐや姫が帝に不老不死の薬を渡したという記述がある。
    ・遣隋地との交流の中でもたらされた（ ③ ）は、鍼術作用や身体を温める効果が期待されていた。一方、交流によって伝染病が拡大することもあった。
    ・タバコは、精神を安定させるために使用されることもあった。
    
    資料【日本に薬を伝えた人物】
    ④鑑真: 唐から来日した。すでに失明していたが、各種の生薬を鼻でかぎ分けられた。仏教の輸入は、当時の医薬の最新情報の輸入だったともいえる。
    （ ⑤ ）: 宋から種子の形で茶を持ち帰って栽培を始め、嗜好品よりも薬としての効能を説いた。茶には眠気をさます効果もあったため、座禅の助けにもなった。
    
    資料【戦争と薬】
    アヘン: アヘンは古くから薬として使用された。18世紀後半から19世紀前半頃には、⑥中国でイギリスから輸入されたインド産のアヘンが広まり、中毒性の高さからたくさんの依存者が出た。これをきっかけとして、アヘン戦争が起こった。
    ⑦日露戦争当時、日本の軍隊は脚死より病死が多かった。そこで強力な殺菌力を持っているクレオソートを丸薬にして兵士たちに配り、軍日服用させた。当時の時代背景に沿って、日本と戦った外国を征伐するという意味で対戦国の外国の文字をとって征露丸と名付けられた。
    ⑧第二次世界大戦では、覚醒戦の対策として毒ガスが使用された。第二次世界大戦中の1943年、イタリアで毒ガスを積んだ船が爆撃を受け、兵士たちに被害が出た。この時、白血球の減少による感染症で亡くなった人がいたことから、毒ガスの成分を抗がん剤（抗白血病薬）に用いることができるとして研究が進んだ。
    
    問1. 空らん（ ① ）について、空らんに入る適切な語句を、次のア～エの中から一つ選び記号で答えなさい。
    ア. 延暦寺  イ. 東大寺  ウ. 法隆寺  エ. 薬師寺
    
    問2. 空らん（ ② ）について、空らんに入る適切な語句を、次のア～エの中から一つ選び記号で答えなさい。
    ア. 伊勢物語  イ. 源氏物語  ウ. 竹取物語  エ. 平家物語
    
    問3. 空らん（ ③ ）について、次の文章は、この食べ物について説明したものです。これについて、（1）と（2）の設問に答えなさい。
    （ ③ ）は、野菜の塩漬けに加えられ、朝鮮半島で有名な食べ物に使われ始めました。一説によると、日本から朝鮮に伝えられたともいわれています。16世紀末に行われた日本による朝鮮への遠征では、相手の目つぶしのための武器として使用されたという説もあります。
    （1）空らん（ ③ ）に入る適切な語句を、次のア～エの中から一つ選び記号で答えなさい。
    ア. 唐辛子  イ. コショウ  ウ. ショウガ  エ. にんにく
    （2）波線の遠征を行った人物についてまちがっている文章を、次のア～エの中から一つ選び記号で答えなさい。
    ア. 大坂に城を築き、全国統一の拠点とした。
    イ. 刀狩令を出すととらに、職業にもとづく身分を定めた。
    ウ. この遠征で得られた賠償金により、政権を安定させた。
    エ. キリスト教の布教を禁止したが、貿易は継続した。
    
    問4. 下線④について、鑑真の生きていた時代（688年～763年）の出来事として正しい文章を、次のア～エの中から一つ選び記号で答えなさい。
    ア. 相武天皇が平安京に遷都を行った。
    イ. 朝廷によって墾田永年私財法が出された。
    ウ. 大海人皇子と大友皇子の間で皇位継承をめぐり争いが起こった。
    エ. 白村江の戦いの後に新羅が朝鮮半島全域を支配した。
    
    問5. 空らん（ ⑤ ）について、あてはまる人物を、次のア～エの中から一つ選び記号で答えなさい。
    ア. 栄西  イ. 道元  ウ. 日蓮  エ. 法然
    
    問6. 下線⑥について、この当時の中国の王朝として正しいものを、次のア～エの中から一つ選び記号で答えなさい。
    ア. 宋  イ. 隋  ウ. 明  エ. 清
    
    問7. 下線⑦について、正しい文章を、次のア～エの中から一つ選び記号で答えなさい。
    ア. 日露戦争の講和条約は、調停国であるアメリカで結ばれた。
    イ. 日露戦争の結果、日本は多額の賠償金を得ることができた。
    ウ. 日露戦争の前、日本は1902年に、ドイツと同盟を結んでいた。
    エ. 日露戦争の後、三国干渉が行われ、遼東半島を中国に返還した。
    
    問8. 下線⑧について、第一次世界大戦中（1914年～1918年）に起こった出来事として正しいものを、次のア～エの中から一つ選び記号で答えなさい。
    ア. 韓国併合  イ. 五・四運動  ウ. 二十一か条の要求  エ. 柳条湖事件
    
    問9. 資料から読み取れることとして正しい文章を、次のア～エの中から一つ選び記号で答えなさい。
    ア. 道隋使や遣唐使、宣教師たちは科学の伝達者でもあった。
    イ. 速い地域との交流は、伝染病が広がる原因ではない。
    ウ. 日露戦争の当時、日本兵の死因は病死よりも戦死の方が多かった。
    エ. 用法によっては、薬は毒にもなりうることもあった。
    
    2. 次の図と文章を読んで、各設問に答えなさい。
    
    今年（2025年）4月から、「大阪・関西万博」が開催されます。多くの②世界の国や地域、企業が参加して展示が行われ、多くの人が訪れることが予想されます。一方で、万博の会場となる夢洲は（ ③ ）現象への対策など、さまざまな課題があります。それらを乗り越え、現在は開幕への最終準備の段階となっています。
    
    今回、万博会場となる④大阪市は、⑤関西地方の中心都市です。現在の関西地方は、古くから日本の政治的な中心地となり、いたるところに⑥集落や都市が形成されてきました。
    
    江戸時代になると、大坂は「天下の台所」と呼ばれ、⑦日本中から農産物が集まる商業都市として発展しました。第二次世界大戦後になると、東大阪市や堺市では⑧地場産業が発展し、沿岸部を中心に阪神工業地帯を形成し⑨工業も発展しました。近年は、⑩関西国際空港を利用して多くの外国人も関西地方を訪れています。
    
    今年は万博が開催されることで、大阪府や関西地方が注目され、さらに活気を得ることになるでしょう。
    
    [地図画像: 大阪市、東大阪市、堺市、夢洲、関西国際空港などの位置関係を示す]
    
    問1. 図中の空らん（①－あ）と（①－い）のそれぞれにあてはまる地名として正しい組み合わせを、次のア～エの中から一つ選び記号で答えなさい。
    ア. (あ) 泉北 － (い) 大淀  イ. (あ) 泉北 － (い) 淀
    ウ. (あ) 千里 － (い) 大淀  エ. (あ) 千里 － (い) 淀
    
    問2. 下線②について、現在、国連に加盟している国の数として正しいものを、次のア～エの中から一つ選び記号で答えなさい。
    ア. 163  イ. 173  ウ. 183  エ. 193
    
    問3. 空らん（ ③ ）について、次の写真に見られる災害を何といいますか。空らんにあてはまるように答えなさい。
    [写真: 地理空間情報技術ミュージアムHP]
    
    問4. 下線④について、大阪市の雨温図として正しいものを、次のア～エの中から一つ選び記号で答えなさい。
    [4つの雨温図のグラフ]
    
    問5. 下線⑤について、次の表は、関西地方における通勤・通学者の状況をしめしたものであり、表中のア～エは、京都府、奈良県、兵庫県、和歌山県のいずれかです。和歌山県にあてはまるものを、次のア～エの中から一つ選び記号で答えなさい。
    [通勤・通学者統計表]
    
    問6. 下線⑥について、関西地方の集落や都市の形成について説明した次の文章のうちまちがっているものを、次のア～エの中から一つ選び記号で答えなさい。
    ア. 大阪府富田林市は、浄土真宗の寺院を中心に信者や商人が集まったことに起源があるとされる都市である。
    イ. 兵庫県芦屋市は、交通の要衝に城が築かれ、その城下町が商業の中心地として発展した都市である。
    ウ. 奈良県十津川村には、戦いに敗れた武士が一族を引き連れて移住し開発を始めたことを起源とする集落がある。
    エ. 奈良県大和郡山市には、農業での水の利用と外敵から守ることを目的に周囲に濠をめぐらせた集落がある。
    
    問7. 下線⑦について、次のグラフは、2023年に大阪府中央卸売市場に出荷された農産物のうち、なすの出荷量を月別にしめしたものです。凡例のAとCにあてはまる県名の組み合わせとして正しいものを、次のア～エの中から一つ選び記号で答えなさい。
    [月別なす出荷量グラフ]
    ア. (A) 徳島 － (C) 福岡  イ. (A) 福岡 － (C) 高知
    ウ. (A) 高知 － (C) 山梨  エ. (A) 山梨 － (C) 徳島
    
    問8. 下線⑧について、都市とそこで盛んな地場産業の組み合わせとして正しいものを、次のア～エの中から一つ選び記号で答えなさい。
    ア. 福井県鯖江市 － タオル  イ. 新潟県燕市 － 金属洋食器
    ウ. 愛媛県今治市 － 打刃物  エ. 大阪府堺市 － 眼鏡
    
    問9. 下線⑨について、次の図は、日本における主な工業製品の2008年から2020年までの生産量の推移をしめしたものであり、図中のあ～えは、冷蔵庫、乗用車、テレビ、プラスチック製品のいずれかです。えにあてはまる工業製品を、次のア～エの中から一つ選び記号で答えなさい。
    [生産量推移グラフ]
    ア. 冷蔵庫  イ. 乗用車  ウ. テレビ  エ. プラスチック製品
    
    問10. 下線⑩について、次の表ア～エは、日本の主な港や空港における輸出・輸入の状況についてしめしたものであり、関西国際空港、大阪港、東京港、名古屋港のうちのいずれかです。関西国際空港にあてはまるものを、次のア～エの中から一つ選び記号で答えなさい。
    [輸出入統計表]
    
    3. 次の文章を読んで、各設問に答えなさい。
    
    2024年7月に①東京都知事選挙が行われました。②さまざまな面で話題になり連日報道されていましたが、最終的に現職の小池氏が当選しました。小池氏は連続三選となり、これまでの積み重ねを踏まえに③「セーフシティ」「ダイバーシティ」「スマートシティ」をテーマに「東京大改革3.0」を打ち出しました。このような目標を掲げてスタートした小池都政ですが、今の日本は「2024年問題」「2025年問題」という大きな変革期を迎えていて、さまざまな課題の中で改革を行うことになりそうです。
    
    2024年問題とは、働き方改革関連法により時間外労働の上限規制が課された ことにともなって発生する問題の総称を指します。本来、時間外労働を制限することは④労働環境を整える意味で良いことですが、このままだと、⑤これまでと同じようなサービスの提供ができなくなると予想されています。現状を維持するには人手不足の状態となるため、「2024年問題」という表現になっているのです。
    
    2025年問題とは、日本が超高齢社会を迎えることで社会において起こるさまざまな問題の総称を指します。戦後間もない1947年～49年は第一次ベビーブームが起こった時期で、この時期に生まれた⑥「団塊の世代」と呼ばれる人たちが2025年に全員75歳以上となることから「2025年問題」と呼ばれています。高齢者が増えると医療や介護の費用が多くかかります。そうなると、国の⑦財政が圧迫されることになるため、問題となりそうです。
    
    このように、2024年問題と2025年問題を抱える中で（ ⑧ ）ということが起こるわけです。実際に、人口の多い東京都であっても、お年寄りが通院などに使用する路線バスが減便、廃止され問題となっています。
    
    問1. 下線①について、都知事選挙で投票できる人を、次のア～エの中から一つ選び記号で答えなさい。
    ア. 16歳/男性/高校生/東京都小金井市在住/神奈川県川崎市にある高校に通っている/アルバイトはしておらず所得はない
    イ. 18歳/女性/大学生/埼玉県草加市在住/東京都足立区にある大学に通っている/アルバイトをしておりル3万円稼いでいる
    ウ. 26歳/男性/大学職員/東京都板橋区在住/埼玉県東松山市にある大学に通勤している/月26万円稼いでいる
    エ. 38歳/女性/主婦/千葉県松戸市在住/東京都武蔵野市にいる実母の介護をした定期的に通っている/所得はない
    
    問2. 下線②について、次の文章はこの選挙で話題となった出来事について説明したものです。文章中の空らん（X）と（Y）に入る適切な語句の組み合わせを、次のア～エの中から一つ選び記号で答えなさい。
    
    今回の東京都知事選挙では、候補者と関係ないポスターが貼られ、撤去作業が行われるなどの混乱が発生しました。作成した候補者は、「（ X ）」を訴えて抵抗しました。
    ポスターの掲示ルールは（ Y ）に規定がありますが、このような事態は想定していませんでした。今回の事例をふまえて、改正すべきではないかという議論が巻き起こりました。
    
    ア. (X) 生存権 － (Y) 独占禁止法
    イ. (X) 生存権 － (Y) 公職選挙法
    ウ. (X) 表現の自由 － (Y) 独占禁止法
    エ. (X) 表現の自由 － (Y) 公職選挙法
    
    問3. 下線③について、次の表は「セーフシティ」「ダイバーシティ」「スマートシティ」について具体的に説明したものです。これについて、（1）～（3）の設問に答えなさい。
    
    [表: 各シティの内容と具体例]
    
    （1）表中の下線aについて、全国各地で起こる数々の災害に対し、日本では自衛隊が派遣され救助や支援が行われてきました。自衛隊に関する説明として正しいものを、次のア～エの中から一つ選び記号で答えなさい。
    ア. 自衛隊を管轄しているのは防衛省である。
    イ. 自衛隊の基地の約70%は沖縄に集中している。
    ウ. 自衛隊はこれまでに海外派遣されたことがない。
    エ. 自衛隊の指揮は天皇が行う国事行為である。
    
    （2）表中の下線bについて、次の文章は、所得税について説明したものです。空らんに入る適切な語句を、次のア～エの中から一つ選び記号で答えなさい。
    
    所得税は、所得に応じて税率が変わる（    ）制度を採用しています。
    
    ア. 確定申告  イ. 軽減税率  ウ. 源泉徴収  エ. 累進課税
    
    （3）表中の下線cについて、デフリンピックはある障がいを持ったアスリートが出場する大会です。どのような障がいを持った方か、次のシンボルマークを参考にして答えなさい。
    [シンボルマーク画像]
    
    問4. 下線④について、労働者の権利を守るために憲法で保障されている「労働三権」のうち、ストライキなどを行う権利として正しいものを、次のア～エの中から一つ選び記号で答えなさい。
    ア. 勤労権  イ. 団結権  ウ. 団体行動権  エ. 団体交渉権
    
    問5. 下線⑤について、この事例に関する文章（X）と（Y）の正誤の組み合わせとして正しいものを、次のア～エの中から一つ選び記号で答えなさい。
    
    （X）1日に運べる荷物の量がこれまでよりも少なくなるので、運送会社のドライバーが翌日配送や再配達も簡単にはできなくなる。
    （Y）1日に運転できる時間がこれまでよりも短くなるので、利用の少ないバスの路線が廃止される。
    
    ア. (X) 正 － (Y) 正  イ. (X) 正 － (Y) 誤
    ウ. (X) 誤 － (Y) 正  エ. (X) 誤 － (Y) 誤
    
    問6. 下線⑥について、次の図は、日本の人口ピラミッドです。図の特徴について説明した文章（X）と（Y）の正誤の組み合わせとして正しいものを、次のア～エの中から一つ選び記号で答えなさい。
    [日本の人口ピラミッド（2025年）]
    
    （X）日本の平均寿命は男性の方が長いことがこの図から読み取れる。
    （Y）「団塊の世代」にあたる75～79歳の世代と「団塊の世代の子どもたち」にあたる50歳～54歳の世代で出生数が多くなっており、ベビーブームが二度起こっていたことが分かる。
    
    ア. (X) 正 － (Y) 正  イ. (X) 正 － (Y) 誤
    ウ. (X) 誤 － (Y) 正  エ. (X) 誤 － (Y) 誤
    
    問7. 下線⑦について、次のグラフは日本の歳出の推移をしめしたものです。(X)～(Z)に入る適切な語句の組み合わせを、次のア～エの中から一つ選び記号で答えなさい。
    [歳出の推移グラフ]
    
    ア. (X) 国債費 － (Y) 社会保障関係費 － (Z) 防衛関係費
    イ. (X) 国債費 － (Y) 防衛関係費 － (Z) 社会保障関係費
    ウ. (X) 社会保障関係費 － (Y) 国債費 － (Z) 防衛関係費
    エ. (X) 社会保障関係費 － (Y) 防衛関係費 － (Z) 国債費
    
    問8. 空らん（ ⑧ ）について、空らんに入る適切な文章を、次のア～エの中から一つ選び記号で答えなさい。
    ア. お年寄りに必要なサービスの需要は増えるし供給も多くなる
    イ. お年寄りに必要なサービスの需要は増えるのに供給は少なくなる
    ウ. お年寄りに必要なサービスの需要は減るのに供給は多くなる
    エ. お年寄りに必要なサービスの需要は減るのに供給は少なくなる
    """
    
    # 分析実行
    analyzer = SocialAnalyzer()
    result = analyzer.analyze_document(text)
    
    # 結果表示
    print("\n" + "="*60)
    print("東京電機大学中学校 2025年 社会科入試問題 分析結果")
    print("="*60)
    
    print(f"\n【基本情報】")
    print(f"総問題数: {result['total_questions']}問")
    
    print(f"\n【分野別分布】")
    if 'field_distribution' in result['statistics']:
        for field, data in result['statistics']['field_distribution'].items():
            print(f"  {field}: {data['count']}問 ({data['percentage']:.1f}%)")
    
    print(f"\n【出題形式】")
    if 'format_distribution' in result['statistics']:
        for format_type, data in sorted(result['statistics']['format_distribution'].items(), 
                                       key=lambda x: x[1]['count'], reverse=True)[:5]:
            print(f"  {format_type}: {data['count']}問 ({data['percentage']:.1f}%)")
    
    print(f"\n【資料活用】")
    if 'resource_usage' in result['statistics']:
        for resource, data in sorted(result['statistics']['resource_usage'].items(), 
                                    key=lambda x: x[1]['count'], reverse=True)[:5]:
            print(f"  {resource}: {data['count']}回使用")
    
    print(f"\n【時事問題】")
    if 'current_affairs' in result['statistics']:
        print(f"  時事問題: {result['statistics']['current_affairs']['count']}問")
        print(f"  主なテーマ: 大阪万博、労働問題、高齢化社会、選挙制度")
    
    print(f"\n【出題テーマ（大問別）】")
    questions = result.get('questions', [])
    
    # 大問ごとにグループ化
    major_questions = {}
    for q in questions:
        major_num = q.number.split('-')[0] if '-' in q.number else q.number
        if major_num not in major_questions:
            major_questions[major_num] = []
        major_questions[major_num].append(q)
    
    # 大問1: 薬の歴史
    print("\n▼ 大問1: 薬の歴史と文化")
    print("  - 古代から現代までの薬の歴史")
    print("  - 日本への薬の伝来（遣唐使、鑑真）")
    print("  - 戦争と医薬品（日露戦争、世界大戦）")
    print("  - アヘン戦争と薬物問題")
    
    # 大問2: 大阪・関西万博と地理
    print("\n▼ 大問2: 大阪・関西万博と関西地方")
    print("  - 2025年大阪・関西万博")
    print("  - 関西地方の地理的特徴")
    print("  - 大阪の産業と歴史")
    print("  - 地場産業と工業地帯")
    
    # 大問3: 現代社会の課題
    print("\n▼ 大問3: 現代日本の社会問題")
    print("  - 東京都知事選挙と選挙制度")
    print("  - 2024年問題（労働改革）")
    print("  - 2025年問題（超高齢社会）")
    print("  - セーフシティ・ダイバーシティ・スマートシティ")
    
    # Excel保存
    formatter = SocialExcelFormatter()
    wb = formatter.create_excel_report(result, "東京電機大学中学校", "2025")
    
    output_path = f"東京電機大学中学校_2025_社会分析_{Path.home()}/Desktop/tdu_2025_analysis.xlsx"
    output_path = Path.home() / "Desktop" / "tdu_2025_social_analysis.xlsx"
    
    formatter.save_excel(wb, str(output_path))
    print(f"\n詳細レポートを保存しました: {output_path}")
    
    return result

if __name__ == "__main__":
    analyze_tdu_2025()