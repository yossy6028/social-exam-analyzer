# Gemini AI 分析機能セットアップガイド

## 概要
Gemini AI を使用した高精度な入試問題分析機能のセットアップ方法を説明します。
この機能により、従来のパターンマッチングでは困難だった以下の問題を解決できます：

- ✅ 正確な問題数の検出（大問・小問の階層構造を正しく認識）
- ✅ OCRエラーの自動補正（「3」が「13」になる等）
- ✅ 受験番号欄などの誤認識を排除
- ✅ 画像やグラフを含む問題の適切な解析
- ✅ 正確なテーマ・キーワード抽出

## セットアップ手順

### 1. Gemini API キーの取得

1. [Google AI Studio](https://makersuite.google.com/app/apikey) にアクセス
2. Google アカウントでログイン
3. 「Get API key」をクリック
4. 新しいAPIキーを作成またはプロジェクトを選択
5. 生成されたAPIキーをコピー

### 2. 環境変数の設定

#### 方法1: .env ファイルを使用（推奨）

プロジェクトルートに `.env` ファイルを作成：

```bash
# .env
GEMINI_API_KEY=your-api-key-here
```

#### 方法2: システム環境変数に設定

```bash
# Mac/Linux
export GEMINI_API_KEY="your-api-key-here"

# Windows (PowerShell)
$env:GEMINI_API_KEY="your-api-key-here"
```

### 3. 依存パッケージのインストール

```bash
pip install google-generativeai==0.3.2
pip install python-dotenv
pip install pdf2image
```

### 4. アプリケーションでの使用方法

1. アプリケーションを起動
   ```bash
   python3 main.py
   ```

2. PDFファイルを選択

3. 「分析オプション」セクションで「Gemini AI分析を使用（高精度）」にチェック

4. 「分析開始」をクリック

## テスト実行

Gemini Analyzer が正しく動作するか確認：

```bash
python3 test_gemini_analyzer.py
```

テストメニューから選択：
- 1: テキスト分析のみ
- 2: Vision分析のみ（推奨）
- 3: 両方実行

## 分析モードの比較

### 従来のパターンマッチング分析
- 高速だが精度に限界
- OCRエラーの影響を受けやすい
- 複雑な構造の認識が困難

### Gemini AI 分析（テキストモード）
- OCRテキストをAIが解析
- 文脈を理解した問題抽出
- OCRエラーをある程度補正

### Gemini Vision 分析（画像モード）**推奨**
- PDFを画像として直接解析
- OCRを経由しないため最も正確
- 図表や写真も含めて理解
- 処理時間は長いが最高精度

## トラブルシューティング

### APIキーが認識されない場合

1. `.env` ファイルがプロジェクトルートにあるか確認
2. APIキーが正しくコピーされているか確認
3. アプリケーションを再起動

### 分析が遅い場合

- Vision API は画像処理のため時間がかかります（1ページあたり5-10秒）
- ネットワーク接続を確認してください

### エラーが発生する場合

```python
# デバッグモードで実行
python3 test_gemini_analyzer.py
```

詳細なエラーログが表示されます。

## 料金について

Gemini API の料金体系：
- Gemini 1.5 Pro: 無料枠あり（1分あたり2リクエストまで）
- 詳細は [Google AI pricing](https://ai.google.dev/pricing) を参照

## セキュリティ注意事項

- APIキーを Git にコミットしないでください
- `.gitignore` に `.env` が含まれていることを確認
- APIキーは定期的に更新することを推奨

## 期待される結果

正しく設定された場合、以下のような分析結果が得られます：

```
【Gemini AI による入試問題分析結果】
============================================================
総問題数: 42問
大問数: 4個

【分野別内訳】
  地理: 11問
  歴史: 13問
  公民: 13問
  時事: 5問

【大問別詳細】
▼ 大問1 (11問)
  問1: 日本の地形と気候 [地理] | 山脈, 平野, 季節風
  問2: 農業の特徴 [地理] | 促成栽培, ビニールハウス, 高知県
  ...
```

## サポート

問題が解決しない場合は、以下の情報と共に報告してください：
- エラーメッセージの全文
- 使用しているPDFファイル名
- Python バージョン（`python3 --version`）
- OS情報